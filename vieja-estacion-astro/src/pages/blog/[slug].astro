---
export const prerender = true;

import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import { getCollection } from 'astro:content';
import { createArticleSchema } from '../../utils/schemas';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

// Create structured data for this blog post
const articleSchema = createArticleSchema({
  title: post.data.title,
  description: post.data.description,
  pubDate: post.data.pubDate,
  heroImage: post.data.heroImage,
  author: post.data.author
});
---

<BaseLayout
  title={post.data.title}
  description={post.data.description}
  image={post.data.heroImage}
  type="article"
  publishedTime={post.data.pubDate.toISOString()}
  schema={articleSchema}
>
  <Header />

  <main>
    <article style="max-width: 800px; margin: 0 auto; padding: 6rem 2rem;">
      <header style="margin-bottom: 3rem;">
        <a href="/blog" style="color: var(--secondary-color); text-decoration: none; display: inline-block; margin-bottom: 2rem;">
          ← Volver al blog
        </a>
        <h1 style="font-size: 2.5rem; margin-bottom: 1rem; line-height: 1.2;">{post.data.title}</h1>
        <div style="display: flex; gap: 1rem; align-items: center; color: var(--secondary-color); margin-bottom: 2rem;">
          <time>{post.data.pubDate.toLocaleDateString('es-AR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          })}</time>
          <span>•</span>
          <span>{post.data.author}</span>
        </div>
        {post.data.heroImage && (
          <img
            src={post.data.heroImage}
            alt={post.data.title}
            style="width: 100%; height: 400px; object-fit: cover; border-radius: 8px;"
          />
        )}
      </header>

      <div class="blog-content" style="font-size: 1.1rem; line-height: 1.8; color: var(--text-color);">
        <Content />
      </div>
    </article>
  </main>

  <Footer />
</BaseLayout>

<style is:global>
  .blog-content h2 {
    font-size: 2rem;
    margin: 2rem 0 1rem;
  }

  .blog-content h3 {
    font-size: 1.5rem;
    margin: 1.5rem 0 1rem;
  }

  .blog-content p {
    margin-bottom: 1.5rem;
  }

  .blog-content ul,
  .blog-content ol {
    margin: 1.5rem 0;
    padding-left: 2rem;
  }

  .blog-content li {
    margin-bottom: 0.5rem;
  }

  .blog-content img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin: 2rem 0;
  }

  .blog-content blockquote {
    border-left: 4px solid var(--primary-color);
    padding-left: 1.5rem;
    margin: 2rem 0;
    font-style: italic;
    color: var(--secondary-color);
  }

  .blog-content code {
    background-color: #f5f5f5;
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    font-family: monospace;
  }

  .blog-content pre {
    background-color: #f5f5f5;
    padding: 1rem;
    border-radius: 8px;
    overflow-x: auto;
    margin: 1.5rem 0;
  }

  .blog-content pre code {
    background-color: transparent;
    padding: 0;
  }
</style>
